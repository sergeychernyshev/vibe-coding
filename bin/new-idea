#!/bin/bash
set -e

TITLE="$1"
OWNER=$(gh repo view --json owner --jq '.owner.login')
REPO_NAME=$(gh repo view --json name --jq '.name')
PROJECT_NUMBER=$("$(dirname "$0")/get-project-number")

# Get the ID of the project
PROJECT_ID=$(gh api graphql -f query='
  query{
    repository(owner:"'"$OWNER"'", name:"'"$REPO_NAME"'"){
      project(number:'"$PROJECT_NUMBER"') {
        id
      }
    }
  }' --jq '.data.repository.project.id')

# Create a new draft issue
gh api graphql -f query='
  mutation {
    addProjectDraftIssue(input: {projectId: "'"$PROJECT_ID"'", title: "'"$TITLE"'"}) {
      clientMutationId
    }
  }'

echo "Created a new draft issue with title: $TITLE"
